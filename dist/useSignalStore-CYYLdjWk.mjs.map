{"version":3,"file":"useSignalStore-CYYLdjWk.mjs","sources":["../hooks/globalStore.js","../hooks/useSignalStore.js"],"sourcesContent":["import { createSignal } from \"react-set-signal\"\r\n\r\nclass GlobalStore {\r\n    store = {}\r\n    // --------------\r\n\r\n    getStore() {\r\n        return this.store\r\n    }\r\n    // --------------\r\n\r\n    getStoreValues() {\r\n        const storeValues = {}\r\n        for (const key in this.store) {\r\n            storeValues[key] = this.store[key].value\r\n        }\r\n        return storeValues\r\n    }\r\n    // --------------\r\n\r\n    getStoreState(id) {\r\n        return this.store[id]\r\n    }\r\n    // --------------\r\n\r\n    setStoreState(key, value) {\r\n        if (!(key in this.store)) {\r\n            this.store[key] = createSignal(value)\r\n            this.store[key].id = key\r\n            console.log(`Created signal with id \"${key}\" in the global store with value:`, value)\r\n        }\r\n        else {\r\n            console.warn(`Signal with id \"${key}\" already exists in the global store. Skipping creation.`)\r\n        }\r\n        return this.store[key]\r\n    }\r\n    // --------------\r\n\r\n    hasState(key) {\r\n        return key in this.store\r\n    }\r\n    // --------------\r\n\r\n    clearStore() {\r\n        this.store = {}\r\n        return this.store\r\n    }\r\n}\r\nconst globalStore = new GlobalStore()\r\n\r\nexport { globalStore, GlobalStore }\r\nexport default globalStore;","import { useMemo } from \"react\";\r\nimport { useReactiveSignal } from \"react-set-signal\";\r\nimport { globalStore } from \"./globalStore\";\r\n\r\n/**\r\n * Internal function to get or create a store signal\r\n */\r\nconst getStoreSignal = (idOrFunction, initialState) => {\r\n    // String ID based store retrieval/creation\r\n    if (typeof idOrFunction === 'string') {\r\n        if (idOrFunction.length === 0) {\r\n            throw new Error('Store ID cannot be an empty string')\r\n        }\r\n        return globalStore.hasState(idOrFunction)\r\n            ? globalStore.getStoreState(idOrFunction)\r\n            : globalStore.setStoreState(idOrFunction, initialState)\r\n    }\r\n\r\n    // Function based store retrieval/creation\r\n    if (typeof idOrFunction === 'function') {\r\n        return idOrFunction(globalStore.getStore())\r\n    }\r\n    throw new Error('useSignalStore expects either a string ID or a function')\r\n}\r\n\r\n/**\r\n * Create a typed useStore hook bound to a specific store\r\n * Supports both string key pattern and function selector pattern.\r\n * \r\n * @param {Object} store - The store object containing signals\r\n * @returns {Function} A typed useStore hook\r\n */\r\nconst createUseStoreHook = (store) => {\r\n    return (keyOrFunction) => {\r\n        // String key pattern\r\n        if (typeof keyOrFunction === 'string') {\r\n            const $signal = useMemo(() => {\r\n                if (!(keyOrFunction in store)) {\r\n                    throw new Error(`Store key \"${keyOrFunction}\" does not exist. Make sure it was defined in createSignalStore.`)\r\n                }\r\n                return store[keyOrFunction]\r\n            }, [keyOrFunction])\r\n            \r\n            const signal = useReactiveSignal($signal)\r\n            return [signal, $signal.set]\r\n        }\r\n        \r\n        // Function selector pattern\r\n        if (typeof keyOrFunction === 'function') {\r\n            const $signal = useMemo(() => {\r\n                return keyOrFunction(store)\r\n            }, [keyOrFunction])\r\n            \r\n            const signal = useReactiveSignal($signal)\r\n            return signal\r\n        }\r\n        \r\n        throw new Error('useStore expects either a string key or a selector function')\r\n    }\r\n}\r\n\r\n/**\r\n * Create multiple signal stores from an initial states object.\r\n * Returns a typed store and useStore hook for full type inference.\r\n * \r\n * @param {Object} initialStates - Object containing initial values for each store\r\n * @returns {{ store: Object, useStore: Function }} An object with the typed store and useStore hook\r\n * \r\n * @example\r\n * const { store, useStore } = createSignalStore({\r\n *   user: { name: 'John', age: 30 },\r\n *   theme: 'light'\r\n * })\r\n * \r\n * // String key pattern - returns [value, setter]\r\n * const [user, setUser] = useStore('user')\r\n * \r\n * // Function selector pattern - returns just the value\r\n * const theme = useStore(s => s.theme)\r\n */\r\nconst createSignalStore = (initialStates) => {\r\n    if (typeof initialStates !== 'object' || initialStates === null) {\r\n        throw new Error(\"createSignalStore expects an object as initialStates\")\r\n    }\r\n    \r\n    // Create all signals in the global store\r\n    for (const key in initialStates) {\r\n        globalStore.setStoreState(key, initialStates[key])\r\n    }\r\n    \r\n    const store = globalStore.getStore()\r\n    \r\n    // Return both the store and a typed useStore hook\r\n    return {\r\n        store,\r\n        useStore: createUseStoreHook(store)\r\n    }\r\n}\r\n\r\n// -----------------------------\r\n// useSignalStore hook (legacy/generic)\r\n// -----------------------------\r\n/**\r\n * A React hook for managing global state using Preact Signals.\r\n * For full type inference, use the useStore hook returned from createSignalStore instead.\r\n * \r\n * @param {string|Function} idOrFunction - Either a string ID or a function that receives the store\r\n * @param {*} initialState - The initial state value (required for string ID pattern)\r\n * @returns {[*, Function]|*} For string ID: [state, setter]. For function: the state value.\r\n */\r\nconst useSignalStore = (idOrFunction, initialState) => {\r\n    const $signal = useMemo(() => getStoreSignal(idOrFunction, initialState), [\r\n        idOrFunction,\r\n        initialState\r\n    ])\r\n    const signal = useReactiveSignal($signal)\r\n    \r\n    // For string pattern: return tuple [state, setter]\r\n    // For function pattern: return just the state value\r\n    if (typeof idOrFunction === 'string') {\r\n        return [signal, $signal.set]\r\n    } else {\r\n        // Function pattern returns just the state\r\n        return signal\r\n    }\r\n}\r\n\r\n// --------------\r\nwindow.globalStore = globalStore\r\n\r\nexport { useSignalStore, createSignalStore }\r\nexport default useSignalStore;"],"names":["GlobalStore","storeValues","key","id","value","createSignal","globalStore","getStoreSignal","idOrFunction","initialState","createUseStoreHook","store","keyOrFunction","$signal","useMemo","useReactiveSignal","createSignalStore","initialStates","useSignalStore","signal"],"mappings":";;AAEA,MAAMA,EAAY;AAAA,EACd,QAAQ,CAAA;AAAA;AAAA,EAGR,WAAW;AACP,WAAO,KAAK;AAAA,EAChB;AAAA;AAAA,EAGA,iBAAiB;AACb,UAAMC,IAAc,CAAA;AACpB,eAAWC,KAAO,KAAK;AACnB,MAAAD,EAAYC,CAAG,IAAI,KAAK,MAAMA,CAAG,EAAE;AAEvC,WAAOD;AAAA,EACX;AAAA;AAAA,EAGA,cAAcE,GAAI;AACd,WAAO,KAAK,MAAMA,CAAE;AAAA,EACxB;AAAA;AAAA,EAGA,cAAcD,GAAKE,GAAO;AACtB,WAAMF,KAAO,KAAK,QAMd,QAAQ,KAAK,mBAAmBA,CAAG,0DAA0D,KAL7F,KAAK,MAAMA,CAAG,IAAIG,EAAaD,CAAK,GACpC,KAAK,MAAMF,CAAG,EAAE,KAAKA,GACrB,QAAQ,IAAI,2BAA2BA,CAAG,qCAAqCE,CAAK,IAKjF,KAAK,MAAMF,CAAG;AAAA,EACzB;AAAA;AAAA,EAGA,SAASA,GAAK;AACV,WAAOA,KAAO,KAAK;AAAA,EACvB;AAAA;AAAA,EAGA,aAAa;AACT,gBAAK,QAAQ,CAAA,GACN,KAAK;AAAA,EAChB;AACJ;AACK,MAACI,IAAc,IAAIN,EAAW,GCzC7BO,IAAiB,CAACC,GAAcC,MAAiB;AAEnD,MAAI,OAAOD,KAAiB,UAAU;AAClC,QAAIA,EAAa,WAAW;AACxB,YAAM,IAAI,MAAM,oCAAoC;AAExD,WAAOF,EAAY,SAASE,CAAY,IAClCF,EAAY,cAAcE,CAAY,IACtCF,EAAY,cAAcE,GAAcC,CAAY;AAAA,EAC9D;AAGA,MAAI,OAAOD,KAAiB;AACxB,WAAOA,EAAaF,EAAY,UAAU;AAE9C,QAAM,IAAI,MAAM,yDAAyD;AAC7E,GASMI,IAAqB,CAACC,MACjB,CAACC,MAAkB;AAEtB,MAAI,OAAOA,KAAkB,UAAU;AACnC,UAAMC,IAAUC,EAAQ,MAAM;AAC1B,UAAI,EAAEF,KAAiBD;AACnB,cAAM,IAAI,MAAM,cAAcC,CAAa,kEAAkE;AAEjH,aAAOD,EAAMC,CAAa;AAAA,IAC9B,GAAG,CAACA,CAAa,CAAC;AAGlB,WAAO,CADQG,EAAkBF,CAAO,GACxBA,EAAQ,GAAG;AAAA,EAC/B;AAGA,MAAI,OAAOD,KAAkB,YAAY;AACrC,UAAMC,IAAUC,EAAQ,MACbF,EAAcD,CAAK,GAC3B,CAACC,CAAa,CAAC;AAGlB,WADeG,EAAkBF,CAAO;AAAA,EAE5C;AAEA,QAAM,IAAI,MAAM,6DAA6D;AACjF,GAsBEG,IAAoB,CAACC,MAAkB;AACzC,MAAI,OAAOA,KAAkB,YAAYA,MAAkB;AACvD,UAAM,IAAI,MAAM,sDAAsD;AAI1E,aAAWf,KAAOe;AACd,IAAAX,EAAY,cAAcJ,GAAKe,EAAcf,CAAG,CAAC;AAGrD,QAAMS,IAAQL,EAAY,SAAQ;AAGlC,SAAO;AAAA,IACH,OAAAK;AAAA,IACA,UAAUD,EAAmBC,CAAK;AAAA,EAC1C;AACA,GAaMO,IAAiB,CAACV,GAAcC,MAAiB;AACnD,QAAMI,IAAUC,EAAQ,MAAMP,EAAeC,GAAcC,CAAY,GAAG;AAAA,IACtED;AAAA,IACAC;AAAA,EACR,CAAK,GACKU,IAASJ,EAAkBF,CAAO;AAIxC,SAAI,OAAOL,KAAiB,WACjB,CAACW,GAAQN,EAAQ,GAAG,IAGpBM;AAEf;AAGA,OAAO,cAAcb;"}